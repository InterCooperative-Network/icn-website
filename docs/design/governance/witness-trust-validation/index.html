<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="A substrate daemon for the cooperative internet. DIDs, trust graphs, mutual credit, CCL contracts, and democratic governance — all in one P2P coordination layer."><meta name="theme-color" content="#06090f"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://intercooperative.network/#organization","name":"InterCooperative Network","url":"https://intercooperative.network","logo":"https://intercooperative.network/favicon.svg","sameAs":["https://github.com/InterCooperative-Network"]},{"@type":"WebSite","@id":"https://intercooperative.network/#website","url":"https://intercooperative.network","name":"InterCooperative Network","description":"A substrate daemon for the cooperative internet.","publisher":{"@id":"https://intercooperative.network/#organization"}}]}</script><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet"><title>Trust-Graph Integration for Witness Validation | InterCooperative Network</title><script>
    // Prevent theme flash
    const theme = (() => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      return 'dark';
    })();
    if (theme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
    } else {
      document.documentElement.removeAttribute('data-theme');
    }
  </script><link rel="stylesheet" href="/_astro/about.EmGYcvGr.css">
<style>.breadcrumb[data-astro-cid-uadgga6g]{display:flex;align-items:center;gap:var(--space-xs);font-size:.8125rem;margin-bottom:var(--space-lg);flex-wrap:wrap}.breadcrumb[data-astro-cid-uadgga6g] a[data-astro-cid-uadgga6g]{color:var(--accent-teal)}.breadcrumb-sep[data-astro-cid-uadgga6g]{color:var(--text-muted)}.breadcrumb-dir[data-astro-cid-uadgga6g]{color:var(--text-secondary);text-transform:capitalize}.breadcrumb-current[data-astro-cid-uadgga6g]{color:var(--text-primary);text-transform:capitalize}.doc-meta[data-astro-cid-uadgga6g]{margin-bottom:var(--space-xl);padding-bottom:var(--space-md);border-bottom:1px solid var(--border-subtle)}.source-link[data-astro-cid-uadgga6g]{font-size:.8125rem;color:var(--text-muted)}.source-link[data-astro-cid-uadgga6g]:hover{color:var(--accent-teal)}.doc-footer[data-astro-cid-uadgga6g]{margin-top:var(--space-3xl);padding-top:var(--space-xl);border-top:1px solid var(--border-subtle)}
</style></head> <body> <!-- Navigation --> <nav class="nav" id="main-nav"> <div class="nav-inner"> <a href="/" class="nav-logo"> <svg class="nav-logo-svg" width="28" height="28" viewBox="0 0 128 128" fill="none"> <rect width="128" height="128" rx="28" fill="url(#nav-bg)"></rect> <line x1="64" y1="30" x2="34" y2="82" stroke="url(#nav-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <line x1="64" y1="30" x2="94" y2="82" stroke="url(#nav-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <line x1="34" y1="82" x2="94" y2="82" stroke="url(#nav-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <circle cx="64" cy="30" r="11" fill="url(#nav-teal)"></circle> <circle cx="34" cy="82" r="11" fill="url(#nav-teal)"></circle> <circle cx="94" cy="82" r="11" fill="url(#nav-teal)"></circle> <circle cx="64" cy="64" r="4" fill="url(#nav-teal)" opacity="0.8"></circle> <defs> <linearGradient id="nav-bg" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#0f2027"></stop><stop offset="1" stop-color="#0a1628"></stop></linearGradient> <linearGradient id="nav-teal" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#2dd4bf"></stop><stop offset="1" stop-color="#38bdf8"></stop></linearGradient> </defs> </svg> <span>ICN</span> </a> <ul class="nav-links" id="nav-links"> <li><a href="/about">About</a></li> <li><a href="/docs" class="active">Docs</a></li> <li><a href="/architecture">Architecture</a></li> <li><a href="/roadmap">Roadmap</a></li> <li><a href="/community">Community</a></li> <li><a href="/blog">Blog</a></li> </ul> <div class="nav-cta"> <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" data-astro-cid-x3pjskd3> <svg class="sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" data-astro-cid-x3pjskd3></path></svg> <svg class="moon-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" data-astro-cid-x3pjskd3></path></svg> </button>  <script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    return 'dark';
  })();

  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
  } else {
    document.documentElement.removeAttribute('data-theme');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    if (element.getAttribute('data-theme') === 'light') {
      element.removeAttribute('data-theme');
      localStorage.setItem('theme', 'dark');
    } else {
      element.setAttribute('data-theme', 'light');
      localStorage.setItem('theme', 'light');
    }
  };

  document.getElementById('theme-toggle')?.addEventListener('click', handleToggleClick);
</script> <a href="https://github.com/InterCooperative-Network/icn" target="_blank" rel="noopener" class="nav-github" aria-label="GitHub"> <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"></path></svg> </a> <a href="/docs/GETTING_STARTED" class="btn btn-primary btn-sm">Get Started</a> </div> <button class="nav-toggle" id="nav-toggle" aria-label="Toggle menu"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"></path></svg> </button> </div> </nav> <!-- Main Content --> <main>  <section class="section" style="padding-top: calc(64px + var(--space-2xl));" data-astro-cid-uadgga6g> <div class="container-narrow" data-astro-cid-uadgga6g> <!-- Breadcrumb --> <nav class="breadcrumb" data-astro-cid-uadgga6g> <a href="/docs" data-astro-cid-uadgga6g>Docs</a> <span class="breadcrumb-sep" data-astro-cid-uadgga6g>/</span>
          <span class="breadcrumb-dir" data-astro-cid-uadgga6g>design</span><span class="breadcrumb-sep" data-astro-cid-uadgga6g>/</span>
          <span class="breadcrumb-dir" data-astro-cid-uadgga6g>governance</span> <span class="breadcrumb-sep" data-astro-cid-uadgga6g>/</span> <span class="breadcrumb-current" data-astro-cid-uadgga6g>witness trust validation</span> </nav> <!-- Source link --> <div class="doc-meta" data-astro-cid-uadgga6g> <a href="https://github.com/InterCooperative-Network/icn/blob/main/design/governance/witness-trust-validation.md" target="_blank" class="source-link" data-astro-cid-uadgga6g>
View source on GitHub →
</a> </div> <!-- Rendered markdown --> <article class="prose" data-astro-cid-uadgga6g><h1>Trust-Graph Integration for Witness Validation</h1>
<h2>Overview</h2>
<p>This document describes the trust-graph integration for witness validation in ICN&#39;s ledger system, implemented to address <a href="https://github.com/InterCooperative-Network/icn/issues/832" target="_blank" rel="noopener">Issue #832</a>.</p>
<h2>Background</h2>
<p>PR #826 added witness signatures for <code>HandoffProcedure</code> completion and high-value transactions. Initially, any DID in the <code>witnesses</code> list could attest to completion. This enhancement integrates ICN&#39;s trust graph to add trust-based requirements for witnesses, preventing collusion with unknown or untrusted entities.</p>
<h2>Features</h2>
<h3>1. Minimum Trust Score Requirements</h3>
<p>Witnesses must have a minimum trust score with all parties involved in the transaction (author and counterparties). This is configured via the <code>min_witness_trust</code> parameter in <code>WitnessConfig</code>:</p>
<pre><code class="language-rust">use icn_ledger::WitnessConfig;

// Require witnesses to have at least partner-level trust (0.4)
let config = WitnessConfig::counterparty_with_trust(
    threshold_value,  // Value above which witnesses are required
    0.4              // Minimum trust score (Partner trust class)
);

ledger.set_witness_config(config);
</code></pre>
<h3>2. Trust Score Thresholds</h3>
<p>Trust scores are in the range [0.0, 1.0] and correspond to ICN&#39;s trust classes:</p>
<ul>
<li><strong>0.0 - 0.1</strong>: Isolated (not yet evaluated)</li>
<li><strong>0.1 - 0.4</strong>: Known (known but not trusted)</li>
<li><strong>0.4 - 0.7</strong>: Partner (trusted partner) ← Recommended minimum</li>
<li><strong>0.7 - 1.0</strong>: Federated (federated peer)</li>
</ul>
<h3>3. Quorum with Trust Requirements</h3>
<p>For quorum-based witness policies, trust requirements apply to all designated witnesses:</p>
<pre><code class="language-rust">let witnesses = vec![did1, did2, did3];
let config = WitnessConfig::quorum_with_trust(
    2,          // Require 2 signatures
    witnesses,  // From these designated witnesses
    0.4        // Each must have minimum trust score of 0.4
);
</code></pre>
<h2>API Reference</h2>
<h3>WitnessConfig Methods</h3>
<pre><code class="language-rust">// Existing methods (backward compatible)
pub fn counterparty_above(threshold: u64) -&gt; Self
pub fn quorum(required: u32, witnesses: Vec&lt;Did&gt;) -&gt; Self

// New methods with trust requirements
pub fn counterparty_with_trust(threshold: u64, min_trust: f64) -&gt; Self
pub fn quorum_with_trust(required: u32, witnesses: Vec&lt;Did&gt;, min_trust: f64) -&gt; Self
</code></pre>
<h3>WitnessConfig Fields</h3>
<pre><code class="language-rust">pub struct WitnessConfig {
    pub default_policy: WitnessPolicy,
    pub threshold: Option&lt;u64&gt;,
    pub collection_timeout_secs: u64,
    
    // New field (optional, backward compatible)
    pub min_witness_trust: Option&lt;f64&gt;,
}
</code></pre>
<h2>Implementation Details</h2>
<h3>Trust Validation Flow</h3>
<ol>
<li><strong>Signature Validation</strong>: Ed25519 signature verification (existing)</li>
<li><strong>Timestamp Validation</strong>: Clock skew and expiration checks (existing)</li>
<li><strong>Trust Validation</strong> (new):<ul>
<li>Extract all transaction parties (author + counterparties)</li>
<li>For each witness, compute trust score from the trust graph owner&#39;s perspective</li>
<li>Reject if witness has insufficient trust score</li>
<li>Skip if trust graph not available (logs warning)</li>
</ul>
</li>
</ol>
<h3>Trust Score Computation</h3>
<p>Trust scores are computed from the trust graph owner&#39;s perspective as a <strong>single scalar value</strong> derived from ICN&#39;s trust graph implementation.</p>
<p>For ledger witness validation, the score uses a single-dimension <code>TrustGraph</code> with fixed weights:</p>
<ul>
<li><strong>Direct trust</strong>: 70%</li>
<li><strong>Transitive trust</strong>: 30%</li>
</ul>
<p>Multi-dimensional trust (social, economic, technical) is supported by the <code>icn-trust</code> crate but is <strong>not</strong> currently used by the ledger witness validation path; only this single aggregated score is consulted.</p>
<h3>Async Implementation</h3>
<p>Trust validation is implemented as an async operation to support non-blocking trust graph lookups:</p>
<pre><code class="language-rust">async fn validate_witness_signatures(
    ledger: &amp;Ledger,
    witnessed: &amp;WitnessedEntry,
) -&gt; Result&lt;()&gt;
</code></pre>
<p>This requires all callers to await the validation:</p>
<pre><code class="language-rust">ledger.validate_witness_signatures(&amp;witnessed).await?;
</code></pre>
<h2>Backward Compatibility</h2>
<p>Trust validation is <strong>fully backward compatible</strong>:</p>
<ol>
<li><strong>Default Behavior</strong>: <code>min_witness_trust</code> defaults to <code>None</code>, disabling trust validation</li>
<li><strong>Existing Configs</strong>: All existing <code>WitnessConfig</code> instances continue to work unchanged</li>
<li><strong>Opt-in</strong>: Trust requirements must be explicitly configured</li>
<li><strong>Graceful Degradation</strong>: If trust graph not available, validation is skipped with a warning</li>
</ol>
<h2>Usage Examples</h2>
<h3>Example 1: Basic Counterparty with Trust</h3>
<pre><code class="language-rust">use icn_ledger::{Ledger, WitnessConfig};

let mut ledger = Ledger::new(store)?;

// Set trust graph (required for trust validation)
ledger.set_trust_graph(trust_graph);

// Require counterparty signature for entries &gt;= 100 hours
// Counterparty must have partner-level trust (0.4)
let config = WitnessConfig::counterparty_with_trust(100, 0.4);
ledger.set_witness_config(config);
</code></pre>
<h3>Example 2: Quorum for High-Value Transfers</h3>
<pre><code class="language-rust">// Require 2-of-3 designated witnesses for high-value transfers
// Each witness must have minimum trust of 0.5
let witnesses = vec![witness1_did, witness2_did, witness3_did];
let config = WitnessConfig::quorum_with_trust(2, witnesses, 0.5);
ledger.set_witness_config(config);
</code></pre>
<h3>Example 3: Backward Compatible (No Trust Validation)</h3>
<pre><code class="language-rust">// Existing code continues to work - no trust validation
let config = WitnessConfig::counterparty_above(100);
ledger.set_witness_config(config);
</code></pre>
<h2>Testing</h2>
<p>Comprehensive test coverage is provided in <code>icn/crates/icn-ledger/tests/witness_trust.rs</code>:</p>
<ul>
<li><strong>test_witness_trust_validation_sufficient_trust</strong>: Witnesses with sufficient trust accepted</li>
<li><strong>test_witness_trust_validation_insufficient_trust</strong>: Witnesses with insufficient trust rejected</li>
<li><strong>test_witness_trust_validation_unknown_witness</strong>: Unknown witnesses (trust = 0.0) rejected</li>
<li><strong>test_witness_trust_validation_backward_compatible</strong>: Existing configs work unchanged</li>
<li><strong>test_witness_trust_validation_no_trust_graph</strong>: Validation skipped if trust graph unavailable</li>
<li><strong>test_witness_trust_validation_quorum_with_trust</strong>: Quorum with trust requirements</li>
<li><strong>test_witness_trust_validation_quorum_insufficient_trusted_witnesses</strong>: Quorum rejects insufficient trust</li>
</ul>
<p>Run tests with:</p>
<pre><code class="language-bash">cd icn
cargo test -p icn-ledger witness_trust
</code></pre>
<h2>Security Considerations</h2>
<h3>Benefits</h3>
<ol>
<li><strong>Prevents Sybil Attacks</strong>: Unknown witnesses cannot attest to transactions</li>
<li><strong>Prevents Collusion</strong>: Witnesses must have established trust with all parties</li>
<li><strong>Community-Specific</strong>: Each cooperative can set its own trust thresholds</li>
<li><strong>Defense in Depth</strong>: Adds trust layer on top of cryptographic signatures</li>
</ol>
<h3>Limitations</h3>
<ol>
<li><strong>Trust Graph Required</strong>: Validation only works if trust graph is configured</li>
<li><strong>Cold Start Problem</strong>: New members may not have sufficient trust edges initially</li>
<li><strong>Trust Computation</strong>: Current implementation uses trust graph owner&#39;s perspective</li>
</ol>
<h3>Best Practices</h3>
<ol>
<li><strong>Set Appropriate Thresholds</strong>: Use 0.4 (Partner) for most high-value transactions</li>
<li><strong>Monitor Trust Edges</strong>: Ensure critical witnesses maintain trust relationships</li>
<li><strong>Grace Periods</strong>: Allow time for witnesses to build trust in new cooperatives</li>
<li><strong>Combine with Value Thresholds</strong>: Only require trusted witnesses above certain values</li>
</ol>
<h2>Future Enhancements</h2>
<p>Potential improvements for future iterations:</p>
<ol>
<li><strong>Per-Party Trust Lookups</strong>: Compute trust from each transaction party&#39;s perspective</li>
<li><strong>Witness-Level Trust Caching</strong>: Build on the existing LRU trust-score cache in <code>TrustGraph</code> by adding caching at the witness-validation layer (e.g., per-transaction or batch validation) to further reduce repeated trust lookups</li>
<li><strong>Governance Integration</strong>: Allow cooperatives to set default witness policies via governance</li>
<li><strong>Trust Decay Handling</strong>: Handle trust score changes over time</li>
<li><strong>Multi-Graph Support</strong>: Use different trust dimensions for different witness requirements</li>
</ol>
<h2>Related Documentation</h2>
<ul>
<li><a href="https://github.com/InterCooperative-Network/icn/blob/main/docs/development/trust-multi-graph-migration">Trust Graph Architecture</a></li>
<li><a href="https://github.com/InterCooperative-Network/icn/blob/main/docs/development/sessions/2026-01/2025-01-17-governance-ledger-integration">Governance Integration</a></li>
<li><a href="https://github.com/InterCooperative-Network/icn/blob/main/docs/reference/config/trust-threshold-configuration">Trust Threshold Configuration</a></li>
<li><a href="https://github.com/InterCooperative-Network/icn/blob/main/docs/security/production-hardening">Production Hardening</a></li>
</ul>
<h2>References</h2>
<ul>
<li>Issue: <a href="https://github.com/InterCooperative-Network/icn/issues/832" target="_blank" rel="noopener">feat(ledger): Add trust-graph integration for witness validation</a></li>
<li>PR: <a href="https://github.com/InterCooperative-Network/icn/pull/826" target="_blank" rel="noopener">feat(ledger): Add witness signatures for HandoffProcedure completion</a></li>
</ul>
</article> <!-- Footer nav --> <div class="doc-footer" data-astro-cid-uadgga6g> <a href="/docs" class="btn btn-ghost" data-astro-cid-uadgga6g>← Back to Docs</a> </div> </div> </section>  </main> <!-- Footer --> <footer class="footer"> <div class="container"> <div class="footer-inner"> <div class="footer-brand"> <a href="/" class="nav-logo"> <svg class="nav-logo-svg" width="28" height="28" viewBox="0 0 128 128" fill="none"> <rect width="128" height="128" rx="28" fill="url(#ft-bg)"></rect> <line x1="64" y1="30" x2="34" y2="82" stroke="url(#ft-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <line x1="64" y1="30" x2="94" y2="82" stroke="url(#ft-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <line x1="34" y1="82" x2="94" y2="82" stroke="url(#ft-teal)" stroke-width="4" stroke-linecap="round" opacity="0.6"></line> <circle cx="64" cy="30" r="11" fill="url(#ft-teal)"></circle> <circle cx="34" cy="82" r="11" fill="url(#ft-teal)"></circle> <circle cx="94" cy="82" r="11" fill="url(#ft-teal)"></circle> <circle cx="64" cy="64" r="4" fill="url(#ft-teal)" opacity="0.8"></circle> <defs> <linearGradient id="ft-bg" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#0f2027"></stop><stop offset="1" stop-color="#0a1628"></stop></linearGradient> <linearGradient id="ft-teal" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#2dd4bf"></stop><stop offset="1" stop-color="#38bdf8"></stop></linearGradient> </defs> </svg> <span>InterCooperative Network</span> </a> <p>A substrate daemon for the cooperative internet. Infrastructure for cooperatives, communities, and federations.</p> </div> <div class="footer-col"> <h4>Project</h4> <ul> <li><a href="/about">About</a></li> <li><a href="/docs">Documentation</a></li> <li><a href="/architecture">Architecture</a></li> <li><a href="/roadmap">Roadmap</a></li> </ul> </div> <div class="footer-col"> <h4>Resources</h4> <ul> <li><a href="/docs/GETTING_STARTED">Getting Started</a></li> <li><a href="/docs/glossary">Glossary</a></li> <li><a href="/docs/CONTRIBUTING">Contributing</a></li> <li><a href="https://github.com/InterCooperative-Network/icn/discussions" target="_blank">Discussions</a></li> </ul> </div> <div class="footer-col"> <h4>Community</h4> <ul> <li><a href="https://github.com/InterCooperative-Network/icn" target="_blank">GitHub</a></li> <li><a href="https://github.com/InterCooperative-Network/icn/issues" target="_blank">Issues</a></li> <li><a href="/community">Community</a></li> </ul> </div> </div> <div class="footer-bottom"> <span>AGPL-3.0 License · InterCooperative Network</span> <span>Built with cooperation, not extraction</span> </div> </div> </footer> <script>
    // Mobile nav toggle
    document.getElementById('nav-toggle')?.addEventListener('click', () => {
      document.getElementById('nav-links')?.classList.toggle('open');
    });

    // Scroll-reveal animations
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('revealed');
          revealObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

    document.querySelectorAll('.card, .section-header, .arch-box, .stage-item, .docs-section-card, .primitive').forEach(el => {
      el.classList.add('reveal');
      revealObserver.observe(el);
    });
  </script> </body> </html> 