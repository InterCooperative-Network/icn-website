---
// src/pages/docs/rfcs.astro
import Layout from '../../layouts/Layout.astro';

let ContentComponent = null;
try {
  const mdModules = await Astro.glob('../../content/docs/rfcs.md');
  if (mdModules && mdModules.length > 0) {
    ContentComponent = mdModules[0].Content;
  }
} catch (e) {
  if (e instanceof Error) {
    console.error(`Error loading markdown for rfcs overview: ${e.message}`);
  } else {
    console.error(`An unknown error occurred while loading markdown for rfcs overview: ${String(e)}`);
  }
}

const topicName = "RFCs";
const githubRepo = "intercoopnet/icn-docs";
const sourceFilePathInUpstream = `rfcs/README.md`; // This is for the main rfcs.md content
const sourceEditUrl = `https://github.com/${githubRepo}/edit/main/${sourceFilePathInUpstream}`;
const sourceViewUrl = `https://github.com/${githubRepo}/blob/main/${sourceFilePathInUpstream}`;

// List of individually rendered RFC pages within the website
const individualRfcs = [
  {
    slug: 'rfc-0010-governance-core',
    title: 'RFC 0010: ICN Governance & Deliberation Core',
    description: 'Defines the foundational governance model of the InterCooperative Network.'
  }
  // Add other individually rendered RFCs here as they are created
];
---

<Layout title={`ICN Docs - ${topicName}`}>
  <div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-bold">{topicName}</h1>
      <div class="text-sm">
        <a href={sourceViewUrl} target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline mr-4">View Source for Overview</a>
        <a href={sourceEditUrl} target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">Edit Overview Page</a>
      </div>
    </div>

    {ContentComponent ? (
      <article class="prose lg:prose-xl max-w-none mb-12">
        <ContentComponent /> {/* Renders content from rfcs.md */}
      </article>
    ) : (
      <div class="text-center py-12 mb-12">
        <h2 class="text-2xl font-semibold mb-4">RFCs Overview - Coming Soon!</h2>
        <p class="text-gray-700">
          The main overview for RFCs (from <code>icn-docs/rfcs/README.md</code>) is currently under development or not yet synced.
          Please check back later or contribute to its creation on GitHub.
        </p>
        <a href={`https://github.com/${githubRepo}/tree/main/rfcs`} target="_blank" rel="noopener noreferrer" class="mt-4 inline-block bg-blue-500 text-white font-semibold py-2 px-4 rounded hover:bg-blue-600">
          View RFCs Directory on GitHub
        </a>
      </div>
    )}

    <hr class="my-12" />

    <h2 class="text-3xl font-semibold mb-6">Detailed RFCs</h2>
    {individualRfcs.length > 0 ? (
      <ul class="space-y-4">
        {individualRfcs.map(rfc => (
          <li class="p-4 border border-gray-300 rounded-md hover:shadow-md">
            <a href={`/docs/${rfc.slug}`} class="text-xl font-semibold text-blue-700 hover:underline">
              {rfc.title}
            </a>
            <p class="text-gray-600 mt-1">{rfc.description}</p>
          </li>
        ))}
      </ul>
    ) : (
      <p class="text-gray-700">No individually rendered RFC pages available yet.</p>
    )}

  </div>
</Layout> 